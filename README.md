# ML-проект на основе сервиса «СберАвтоподписка»

**«СберАвтоподписка»** — это сервис долгосрочной аренды автомобилей для физлиц.

**Цель проекта:** научиться предсказывать совершение пользователем целевого действия («Оставить заявку» или «Заказать звонок») на сайте «СберАвтоподписки» и упаковать получившуюся модель в сервис, который будет брать на вход атрибуты типа `visit_*` (время визита на сайт), `utm_*` (рекламные метки), `device_*` (характеристики устройства), `geo_*` (местоположение) и отдавать на выход 0/1 (1 — если пользователь совершит любое целевое действие).

**Целевые метрики:** `ROC-AUC` > 0.65, время предсказания не более 3 секунд.

## Структура проекта
* `Data Preparation.ipynb` - ноутбук с разведочным анализом данных и генерацией сбалансированного датасета.
* `main.py` - файл для запуска сервиса с помощью FastAPI.
* `requirements.txt` - необходимые библиотеки для выполнения проекта.
* `model` - папка с ML-моделью. Содержит файл `pipeline.py` с обучением и сериализацией модели.
Так же для корректной работы проекта нужно создать в папке model папку `data`. В папку data поместить файлы `ga_hits.pkl` и `ga_sessions.pkl`, которые можно скачать [отсюда](https://drive.google.com/drive/folders/1rA4o6KHH-M2KMvBLHp5DZ5gioF2q7hZw) - это исходные датасеты для анализа данных и моделирования.

## Запуск проекта
1. Запустить ноутбук `Data Preparation.ipynb` и пошагово отработать каждую ячейку для анализа данных и генерации очищенного датасета.
2. Запустить скрипт `pipeline.py`, в результате выполнения которого в папке `model` сгенерируется файл `sber_auto_pipe.pkl`, содержащий ML-модель, которая по результатам моделирования показала наибольшее значение ROC-AUC.
3. В корневой папке проекта выполнить команду для запуска сервиса:
```sh
uvicorn main:app --reload
```
В сервисе реализованы следующие API-методы:
* `GET/status` - возвращает строку 'I’m OK'. 
* `GET/version` - возвращает словарь, содержащий информацию о модели (название модели, имя автора, версия, дата создания, тип решающего алгоритма и метрика ROC-AUC, достигнутая на кросс-валидации), в формате:
```json
{
    'name': 'Target action prediction model',
    'author': 'Tatiana Murmuliak',
    'version': 1,
    'date': '2024-08-08T20:39:29.284874',
    'type': 'RandomForestClassifier',
    'roc_auc': 0.6967
}
```

* `POST/prediction` - принимает JSON-объект, содержащий информацию о визите пользователя на сайт «СберАвтоподписки» (session_id, client_id, visit_*, utm_\*\, device_\*\, geo_\*\) и возвращает предсказание модели в формате 0/1 (1 — если пользователь совершит любое целевое действие).

## Пример предсказания модели
```json
{
    'session_id': '7750352294969115059.1640271109.1640271109',
    'client_id': '2.108383677679459',
    'pred': 1
}
```
